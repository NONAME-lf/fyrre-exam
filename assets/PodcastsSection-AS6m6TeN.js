import{r as a,j as d}from"./index-DPwbfeyc.js";import{S as x}from"./SectionHeader-C4478--j.js";import{P as E}from"./PodcastCard-UQB-PX3h.js";function T(n){const[f,S]=a.useState([]),[h,g]=a.useState([]),[u,y]=a.useState(3),[i,p]=a.useState("");a.useEffect(()=>{!i&&l()},[i]),a.useEffect(()=>{n.quantity&&y(n.quantity)},[n]),a.useEffect(()=>{_()},[i,n.data]),a.useEffect(()=>{k(u)},[f,u]);const _=async()=>{!i||!n.data||w().then(t=>{t&&S(t)})},l=async()=>{const t=sessionStorage.getItem("spotify_token"),o=sessionStorage.getItem("spotify_token_expire");if(t&&o&&o>Date.now()){p(t);return}try{const e=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa("2528bed089484ce395bd0140a029f5cf:db3d6d425a2c44dd9c7ec26c3971eee1")},body:new URLSearchParams({grant_type:"client_credentials"})});if(e.ok){const s=await e.json(),r=Date.now()+s.expires_in*1e3;sessionStorage.setItem("spotify_token",s.access_token),sessionStorage.setItem("spotify_token_expire",r),p(s.access_token)}}catch(e){console.error(e)}},w=async()=>{if(!i||!n.data)return;const t=sessionStorage.getItem("spotify_token"),o=sessionStorage.getItem("spotify_token_expire");if(t&&o&&o<Date.now()){l();return}try{const e=[];for(const s of n.data){const r=localStorage.getItem(`spotify_show_${s.id}`);if(r){e.push(JSON.parse(r));continue}const c=await fetch(`https://api.spotify.com/v1/shows/${s.id}`,{method:"GET",headers:{Authorization:"Bearer "+i}});if(c.ok){const m=await c.json();localStorage.setItem(`spotify_show_${s.id}`,JSON.stringify(m)),e.push(m)}else throw new Error("Failed to fetch data, with status: "+c.status)}return e}catch(e){console.error(e)}},k=t=>{if(!f||f.length===0)return;const o=[];f.forEach(e=>{e.episodes&&e.episodes.items.forEach((s,r)=>{if(o.length<t){const c=localStorage.getItem(`spotify_episode_${s.id}`);if(c){o.push(JSON.parse(c));return}s.epNum=t-r,localStorage.setItem(`spotify_episode_${s.id}`,JSON.stringify(s)),o.push(s)}else{g(o);return}})})};return d.jsxs("section",{className:"podcasts-section",children:[n.sectionHeader&&d.jsx(x,{title:"Podcasts",highlight:"AllÂ ",text:"Episodes",to:"/podcast"}),d.jsx("ul",{className:"podcast-list",children:h.map((t,o)=>d.jsx("li",{children:d.jsx(E,{epNum:n.epNum&&h.length-o,episode:t,episodeNum:h.length-h.indexOf(t),border:"grid-border",orientation:n.orientation||""})},t.id))})]})}export{T as default};
